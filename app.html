<!DOCTYPE html>
<html>
    <head>
        <title>Policy Tracker App</title>
        <link type="text/css" rel="stylesheet" href="app.css"  />
        <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.0.7/css/all.css">
        <!-- <script type="module" src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js"></script>
        <script type="module" src="https://www.gstatic.com/firebasejs/10.12.2/firebase-analytics.js"></script>
        <script type="module" src="https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js"></script>
        <script type="module" src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js"></script>  -->
      
    </head>
    <body>
        <input type="hidden" id="auth" />
        <header>
            <div id="upper-header">
                <div id="logo">
                    <img alt="leadway-logo" src="./images/leadway_black_logo.png" id="logo-img"/>
                </div>
                <div id="left-block">
                    <div id="app-title">
                        <h3>Policy Tracker App</h3>
                    </div>
                    <div id="search-block">
                        <div id="main-search-box">
                            <input type="search" placeholder="Search by Policy Number or Client Name"/>
                            <button id="search-btn"><i class="fa fa-search fa-2x" aria-hidden="true"></i></button>
                        </div>
                    </div>
                </div>
            </div>
            <div id="lower-header">
                <div class="tab-item" name="register">Register Policy</div>
                <div class="tab-item" name="all-policies">All Policies</div>
                <div class="tab-item" name="this-month">This Month</div>
                <div class="tab-item" name="next-month">Next Month</div>
                <div class="tab-item" name="2-months-time">2-Months-Time</div>
                <div class="tab-item" name="3-months-time">3-Months-Time</div>
            </div>
        </header>
        <div id="current-content"></div>
        <script type="text/javascript" src="firebaseSetting.js"></script> 
        <!-- <script type="module" src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js"></script> -->
        <!-- <script type="module" src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
        <script type="module" src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js"></script>
        <script type="module" src="https://www.gstatic.com/firebasejs/10.12.2/firebase-auth-compat.js"></script> -->
        <!-- <script type="module" src="https://www.gstatic.com/firebasejs/10.12.2/firebase-analytics.js"></script> -->
        <!-- <script type="module" src="https://www.gstatic.com/firebasejs/8.2.1/firebase-database.js"></script> -->
        <script type="text/javascript" src="PolicyStorage.js"></script>
        <script type="text/javascript" src="app.js"></script>       
        <script type="module">
            import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js'

            
            // If you enabled Analytics in your project, add the Firebase SDK for Google Analytics
            import { getAnalytics } from 'https://www.gstatic.com/firebasejs/10.12.2/firebase-analytics.js'
            
            // Add Firebase products that you want to use
            import { getAuth, signInWithEmailAndPassword, createUserWithEmailAndPassword } from 'https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js'
            import { getFirestore, collection, addDoc, doc, getDocs } from 'https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js'
            
            const firebaseApp = initializeApp({
                apiKey: SETTINGS.apiKey,
                authDomain: SETTINGS.authDomain,
                projectId: SETTINGS.projectId,
                storageBucket: SETTINGS.storageBucket,
                messagingSenderId: SETTINGS.messagingSenderId,
                appId: SETTINGS.appId,
                measurementId: SETTINGS.measurementId
                });

                let store = getFirestore();
                let auth = getAuth();

                const collectionRef = collection(store, 'policies');

                let submitPolicyBtn = document.getElementById('policy-save-btn');


                submitPolicyBtn.addEventListener('click', (e) => {
                    e.preventDefault();

                    let holderName = document.getElementById('holder-name');
                let policyNumber = document.getElementById('policy-number');
                let clientType = document.getElementById('client-type');
                let policyDate = document.getElementById('policy-date');
                let policyClass = document.getElementById('policy-class');
                let policySubClass = document.getElementById('policy-sub-class');
                let paymentMode = document.getElementById('payment-mode');
                let premiumPaid = document.getElementById('premium-paid');

let policyToSave = {
    "holder_name": holderName.value,
    "policy_number": policyNumber.value,
    "client_type": clientType.value,
    "policy_date": policyDate.value,
    "policy_class": policyClass.value,
    "policy_sub_class": policySubClass.value,
    "payment_mode": paymentMode.value,
    "premium_paid": premiumPaid.value
}

    if(holderName.value && policyNumber.value && clientType.value && policyDate.value && policyClass.value && policySubClass.value && paymentMode.value && premiumPaid.value) {

        console.log(policyToSave);
        addDoc(collectionRef, {...policyToSave}).then(() => showAlertView(true, "Success", "Policy successfully saved!")).catch(err => showAlertView(true, "Error!", err.message));
    } else {
        showAlertView(true, "Incomplete Data!", "Fill all available fields!");
    }
});

    submitPolicyBtn.addEventListener('mouseenter', () => {
        submitPolicyBtn.style.backgroundColor = 'orangered';
        submitPolicyBtn.style.transition = '0.7s';
        
     });
    
    submitPolicyBtn.addEventListener('mouseleave', () => {
        submitPolicyBtn.style.backgroundColor = 'orange';
        submitPolicyBtn.style.transition = '0.7s';
   
    });
    
    getDocs(collectionRef).then(data => {
            let fetchedPolicies = data.docs.map(item => {
                return {...item.data(), id: item.id}
            });

            localStorage.setItem("firebase_policies", JSON.stringify({"policies": fetchedPolicies}));
    }).catch(err => showAlertView(true, "Error!", err.message));

          </script>
          <footer>
            <p>Policy Tracker App by Isenewo Oluwaseyi</p>
            <p>All rights reserved &copy; 2024</p>
          </footer>
    </body>
</html>